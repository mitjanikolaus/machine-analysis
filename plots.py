import matplotlib.pyplot as plt
import sys


class PlotManager:

    def __init__(self, all=False):
        self.first = True
        self.all = all
        self.path = '../report/figures/'

    def next(self):
        plt.clf()
        if not self.all and not self.first: sys.exit()
        self.first = False

    def get_path(self, filename) -> str:
        return self.path + filename + '.pdf'


plot_manager = PlotManager(all=True)

## Adding singular neurons one by one
mse_with_number_of_neurons = [0.1946528107, 0.189652428, 0.1459174603, 0.1481689364, 0.141743511, 0.1754585505, 0.171440497, 0.1599081606, 0.1808615029, 0.1627180427, 0.1786903292, 0.1661878228, 0.1701991707, 0.1806901842, 0.1576678157, 0.1421564668, 0.1282975823, 0.1162425578, 0.1293349713, 0.1276482046, 0.1579914987, 0.1276618987, 0.1337364763, 0.1138186753, 0.1434383988, 0.1154987961, 0.100597471, 0.1229445189, 0.1255652308, ]
reference_mse = 0.008

plt.figure(figsize=(8,3))
plt.plot(range(len(mse_with_number_of_neurons)), mse_with_number_of_neurons, label='MSE adding neurons stepwise')
plt.plot(range(30), [reference_mse]*30, label='MSE with all features')
plt.xlabel('Number of neurons')
plt.ylabel('MSE')
plt.savefig(plot_manager.get_path('stepwise_adding_neurons'))

plot_manager.next()


## Ablation study count prediction
marginals = [
    0.002457892, -0.0002183189, 0.0004853908, -0.0009875168, 0.0006158793, -0.0013839245, 0.0007572886, 0.0007373685, 0.0005561927, -1.21627000000003E-05, 0.001257976, 0.0022360249, -0.0011856799, 0.0027879015, 0.0018431576, 0.0014467979, -0.00083686, 0.0014421273, 0.0012762206, 0.0004045464, 5.83552000000005E-05, 0.0016327327, -0.000533897, 0.0010237334, -0.0025406634, 0.0029843491, 0.000002515, -0.0007756186, 0.0022931168, -0.0001563957, 0.0009070201, -0.0009164625, 0.0004061204, 0.0008265641, -0.0006925539, 3.73870000000033E-06, 0.0009121684, 8.5292800000001E-05, 0.0001262756, 0.0003644912, -0.0016805088, -0.000593877, -0.0009174613, -0.0004580366, 0.0001008319, -0.0014001556, 0.0005590761, 0.0010815965, -0.0008215407, 0.0024499524, 0.0007730335, -0.0013019737, -0.0007382874, 0.0018262466, -0.0010117573, 0.0006189574, -0.0003669156, 0.0027732164, 0.00261277, 0.0015365206, -0.0005642195, 0.0018915016, -0.0013544821, -0.0011252678, -0.0028166055, 0.0009022359, 0.0010716658, -0.001911366, -0.0004762668, 0.0013100434, -0.00082014, 0.0023008077, 0.0035675889, -0.0004486652, 0.0005064778, -0.0002840344, -0.0021544258, 0.000039942, -5.82845999999998E-05, -0.0005765116, -0.0015765234, 0.0005671935, -0.0009468962, 0.0030280709, -0.0016925331, -0.0013094173, 9.72453999999994E-05, 0.001250409, 0.0001692571, -0.0012227898, 9.13276999999994E-05, 0.0003385045, 0.000063931, -0.0001528408, 0.0017133927, 0.000312827, -0.000221294, -0.0003473918, 0.0033549875, -0.000854991, -0.0013082564, -0.0019755476, -0.0018412732, 0.0012249019, -0.0019975119, 0.0015450282, 0.0005327355, 0.0020367814, -0.0015163204, 0.0020995945, -0.0011440223, 0.001745378, 0.0002771899, -0.0004682053, 0.0022674272, -0.0007297439, -0.001600491, 0.0007317768, 0.0012744678, 0.0025656767, 0.000158653, 0.0001543569, 0.0012675118, -2.59677000000007E-05, 0.0009257089, -0.0007780828, -0.0010822668, 0.0036735948, 0.0021576811, 0.0025721178, 0.0006958911, 0.0006442791, 0.0002169091, 0.0010647275, 0.0013419254, 0.0011594253, 0.0016835839, 0.0004538981, 0.0006991414, -0.0002875455, -0.0013353448, 0.0005299686, -5.39510999999996E-05, -0.0003491785, 0.0003657838, -0.0006793636, -0.0009842511, -0.00163665, 0.0021934327, -0.0005286365, -0.0014632713, 8.06305999999993E-05, 0.0005291779, 0.000519995, -0.0007965505, 0.0004624104, 6.28712E-05, 0.000588573, 0.0009909434, -0.0002872852, -0.0015097797, 0.0015963133, -8.02302999999994E-05, 0.0006979754, -0.0011407468, -0.0003625207, -0.0004429664, -0.0006948738, -0.0010942236, 0.0022355275, -0.0027599238, -0.0001924858, 0.0022822799, -0.0004619053, 0.0002766358, -0.0001086477, 0.0015208185, -0.0009794092, 0.0026769837, -0.0012526289, -0.0009584805, -0.0011727899, -0.0006049048, -0.0005654801, 0.000683742, -0.0004916392, -0.0024287729, 0.001617025, 0.0027675306, -0.0002501165, -0.0008060696, 0.003747662, 0.0008718543, -0.0003798661, 0.0007208226, 8.72187000000007E-05, -6.98125000000004E-05, 0.0014167637, 0.001038358, -0.001076188, 0.0004253186, 0.0006146165, 0.0006898496, 0.0026602423, 3.1016200000001E-05, -0.0005840925, 0.0014626881, -0.001169493, -0.000368069, -0.0003177361, 0.0028472351, -0.0015080488, 0.0003222743, 0.0021902448, -0.0003074548, 0.0003185975, 0.0014588427, -0.0016095537, 0.001990681, 0.0003092544, -0.0006108024, 0.0008126333, 0.0016602682, -0.0011240031, -0.0007931805, -0.0006907145, 0.0004972121, -0.0005534874, -9.23347000000001E-05, 0.0012761107, 0.0007873423, 0.000307429, -0.0008353555, 0.0005598221, 0.0006641358, -0.0001218827, 0.0014408132, -0.0007377417, 0.0012140371, 0.001054441, 0.0001975805, 0.0018995194, 0.0014454642, -1.35307999999997E-05, 0.0016137784, -0.0006883625, -0.0021331986, 0.0002758162, -0.0001424584, 0.0005772509, -0.0010490972, -0.0006081966, 0.0014093941, -0.0009011269, 0.0013838619, -0.000668136, -0.0017997102, -0.0005523605, 0.0010015763, -4.22844999999998E-05, -0.0001081793, -5.07465000000006E-05, 0.0001716543, -0.0010069917, -0.0017819717, 0.0013693156, -0.0010006769, -0.0013753763, -0.0004708456, 0.0007947398, 0.0017323749, 0.0020571783, 0.0009377528, 0.0004582567, 0.0010052141, -0.0007490279, 0.0007058954, -6.53813000000003E-05, -0.0005076244, 0.0012628216, -0.0006205701, 0.0019593997, -0.0007724199, 0.0005412599, 0.0007892786, -0.0015106691, -0.0008109688, 0.0015635941, 0.000819161, -0.0004066802, 0.0016120909, 0.0001948759, 0.0013703596, 0.0023133544, 0.0026677236, -0.0006950354, -0.0012115967, 0.0007801944, 0.0019873943, 0.0010439953, -0.0019069841, -0.000348514, -0.0004314171, -0.0009337348, 0.0004030926, -0.0005857303, -0.0015324369, 0.002415866, 0.0008018822, 0.0010331761, 0.000857917, 5.24831999999999E-05, 0.0004446026, -0.0019958532, -0.001509687, -0.0008501276, 0.0022068121, -0.0022803555, 0.000372467, 0.0004562739, 0.0015226783, 0.0014062472, -0.0001077732, 0.0026930053, -0.0002282887, 0.0015079364, 0.0004355604, -0.0005556942, 0.0007175351, 0.0013964916, 0.0005868463, -0.0008661995, -2.12588999999996E-05, -4.80484000000003E-05, 0.0019830218, -0.0013428648, -0.0009669937, 0.0012142066, 0.0003286408, -0.0015888662, -0.0003723065, 0.0025905738, 0.0009468434, -0.0003186693, -3.14215E-05, 3.10488000000008E-05, -0.0014425456, 0.0004598372, 0.0008203121, 0.0010751071, 0.0005254582, 0.0003569661, -0.0001050416, -7.21817999999996E-05, -0.0005650866, 0.0027261213, -0.0001462005, 0.0004334109, 0.0014521828, -0.0011046655, -0.0004653098, -0.0001236327, 0.0002405824, 0.0003394535, 0.0016467808, -0.0003041426, 0.0011680922, -0.0006908594, -0.0005636332, -0.0014062464, -0.000714256, -0.0004637866, -0.0017453135, -0.0011354993, -0.0006212709, 0.0010928636, 0.0004788147, -0.000732516, 5.03002000000006E-05, 0.0018476745, 0.0007833898, -0.0007172572, 0.0011190543, -0.0004576534, -0.0015840196, -0.0020025746, -0.0011160663, 0.000567228, -0.0004841714, 0.0036258748, 0.0004307436, 0.0007626595, 0.0010594953, -0.0006017071, -0.0001817221, -0.0014327239, -0.0024239436, -0.0017702348, 0.001471396, -0.0014063805, 0.0018943086, -0.0008386356, -0.0010280838, 0.0001011206, 0.0006460775, -0.0004876681, -0.0011476885, -0.0008691727, -0.0014831061, -0.0015213518, 0.0032757655, 0.0006346576, 0.0017584669, -0.0010774961, 0.001380525, 0.0012872316, -0.0014283337, 0.000510435, 0.0008365925, -0.0014274331, 4.84626999999998E-05, -0.001158225, 0.0003011957, 0.0009751892, -0.000100467, 0.0002687978, 0.0001384443, -0.0015763236, 0.0011847172, 0.001037504, -0.0015927098, -0.0014709594, -0.000837558, -0.0006169938, 0.0003240056, 0.0007498734, -0.0001098873, 0.0011428962, 0.0032943193, 0.0033923214, -0.0013384019, 0.0009571793, 0.0008770082, -0.0004198138, -0.0008935454, 0.0003663575, -0.0010465738, 0.001144919, 0.0023274193, 0.0012517845, -0.0008297782, -0.0012342996, -0.0004071124, 0.0014106784, -0.0002727724, -0.0009707246, 0.0017861225, 0.0001153009, -0.0014518696, -0.000716325, 0.0001591383, 0.0004008137, 0.0001838164, -0.0013488322, -0.0002902081, -0.0004004963, 0.0008536385, 0.0018210229, 0.0012796832, -0.0003153506, 0.0026313443, 0.0022652712, -0.0009923229, 0.0010189241, -0.0002691113, 0.000473346, 0.0019101271, -0.0001030141, -0.0001588292, -8.87527999999995E-05, 0.0025905356, -0.0002628468, -0.0008664193, -0.000259122, 0.0011577545, -0.0017042901, 0.0003291596, 0.0001394501, 0.0002410518, -0.0006948319, -0.0006066818, -0.0002484723, 0.0008631818, -0.0012075553, -0.0014515692, -0.0009709532, 0.0008004256, 0.0010997657, 0.0012514306, 0.0003276099, -0.000811563, -0.0010891981, -0.0003308669, 0.0002751038, -0.0008836823, 0.0005381558, 0.0021394933, 0.0009706937, -0.0012227526, 0.0008231936, 0.0010992386, 0.0010582725
]

plt.figure(figsize=(8,3))
plt.bar(range(len(marginals)), sorted(marginals, reverse=True))
plt.xlabel('Neurons')
plt.ylabel('Marginal contribution')
plt.tick_params(
    axis='x',
    which='both',
    bottom=False,
    top=False,
    labelbottom=False
)
plt.savefig(plot_manager.get_path('ablation_study_count_prediction'))
plot_manager.next()

## Single neuron count predictions
MSE_single_neurons = [
    0.2151004672, 0.2157256156, 0.2212626338, 0.230287388, 0.232755512, 0.2556426823, 0.2594729364, 0.2662881613, 0.272520721, 0.2730296254, 0.2765368521, 0.2801107764, 0.2815755308, 0.2837333381, 0.3004027605, 0.3018872142, 0.3023208082, 0.3201714456, 0.3363550901, 0.3432750106, 0.3455297947, 0.3481091857, 0.3577957153, 0.3617197275, 0.3638370037, 0.3763999343, 0.3771260977, 0.3820834756, 0.3836886883, 0.3881649971, 0.3885973692, 0.3956436813, 0.4139257967, 0.4156946242, 0.4158706665, 0.4163119197, 0.4276780486, 0.4327490926, 0.4437128305, 0.4494444132, 0.4804139435, 0.4856918752, 0.4897903204, 0.4955502748, 0.5146823525, 0.5156646967, 0.5268708467, 0.533272028, 0.537874043, 0.5487584472, 0.5494567156, 0.5630270243, 0.5705350041, 0.5838828683, 0.5900261402, 0.631054461, 0.6367051601, 0.6393817663, 0.6438016295, 0.6486648917, 0.6553586721, 0.6668162346, 0.6691364646, 0.6788593531, 0.6820918322, 0.6892023683, 0.6919728518, 0.6973803043, 0.6997282505, 0.7000631094, 0.7048195004, 0.7081072927, 0.7081831694, 0.7113691568, 0.7229509354, 0.7249503732, 0.7272855639, 0.7393544316, 0.7495446205, 0.7532337904, 0.7653701305, 0.776825428, 0.7797596455, 0.7812495828, 0.7894728184, 0.7943142653, 0.7959173918, 0.8014182448, 0.8015469313, 0.818508029, 0.8209479451, 0.8227912784, 0.8234962225, 0.8265534043, 0.8271896243, 0.8325180411, 0.8387823701, 0.8451409936, 0.8475967646, 0.8511632681, 0.8550447226, 0.8563283682, 0.8721912503, 0.8885717988, 0.8890795112, 0.891292274, 0.9164347649, 0.9169947505, 0.9178050756, 0.9219482541, 0.9220163226, 0.9284313917, 0.9379216433, 0.9409227371, 0.9509114623, 0.9532058239, 0.9548485875, 0.9593759179, 0.9700068831, 0.9730665684, 0.9772356749, 0.9891790748, 0.9945960641, 0.998309195, 1.0071008205, 1.009837985, 1.0169165134, 1.0180817842, 1.01894629, 1.0204489231, 1.0221039057, 1.0225613117, 1.032325387, 1.0326691866, 1.0331212282, 1.033427, 1.0359688997, 1.0392750502, 1.0427544117, 1.0440713167, 1.0490889549, 1.0522542, 1.0524460077, 1.0545679331, 1.0576261282, 1.0576682091, 1.0616929531, 1.0631206036, 1.0633790493, 1.0670406818, 1.0695016384, 1.0790131092, 1.0797542334, 1.0861836672, 1.08979249, 1.0899119377, 1.0932579041, 1.0989025831, 1.1004627943, 1.1008000374, 1.101565361, 1.1096121073, 1.1102125645, 1.1103076935, 1.1104012728, 1.1173872948, 1.1181749105, 1.1187946796, 1.120190382, 1.1230623722, 1.1234166622, 1.1260786057, 1.1267858744, 1.1279357672, 1.1287002563, 1.1306778193, 1.1338840723, 1.1349782944, 1.135389328, 1.1376045942, 1.1390278339, 1.1459755898, 1.1461628675, 1.1471216679, 1.1485186815, 1.1504547596, 1.1513513327, 1.1529994011, 1.153003931, 1.1559108496, 1.1605758667, 1.1624655724, 1.16248703, 1.1625506878, 1.16386199, 1.1658674479, 1.1663254499, 1.1665301323, 1.1665440798, 1.1674904823, 1.1680432558, 1.168410182, 1.1685183048, 1.170091629, 1.1720211506, 1.1745659113, 1.1767550707, 1.1769292355, 1.1775352955, 1.1775869131, 1.1784756184, 1.1789722443, 1.1801396608, 1.1801919937, 1.181017518, 1.1815038919, 1.1844989061, 1.1846592426, 1.184994936, 1.1856925488, 1.1862417459, 1.1864227057, 1.1866255999, 1.1884063482, 1.1893951893, 1.18953228, 1.1897780895, 1.1899604797, 1.1901546717, 1.1907566786, 1.1914240122, 1.1925872564, 1.1928287745, 1.1936472654, 1.1943064928, 1.194494009, 1.1951090097, 1.1953364611, 1.1956880093, 1.1960104704, 1.1962168217, 1.1962686777, 1.1963092089, 1.1968411207, 1.1971002817, 1.197440505, 1.1980657578, 1.1984491348, 1.1991889477, 1.1992082596, 1.1992843151, 1.1993328333, 1.1997345686, 1.2001643181, 1.2013094425, 1.2015236616, 1.201539278, 1.2015869617, 1.2023489475, 1.2032545805, 1.2035322189, 1.2037309408, 1.2038487196, 1.2041113377, 1.206684351, 1.2070426941, 1.2072650194, 1.2077810764, 1.2080500126, 1.2081561089, 1.209104538, 1.2091282606, 1.2100837231, 1.2102366686, 1.2104830742, 1.2108297348, 1.2109309435, 1.211540103, 1.2116308212, 1.2121009827, 1.2121934891, 1.2124938965, 1.2131847143, 1.2132068872, 1.2135845423, 1.2140730619, 1.2147357464, 1.2150610685, 1.2151470184, 1.2152401209, 1.2154252529, 1.2156635523, 1.2159414291, 1.2160161734, 1.2163740396, 1.2167128325, 1.2171857357, 1.2180374861, 1.2182201147, 1.2185064554, 1.2189496756, 1.2190291882, 1.219156146, 1.2192054987, 1.2192744017, 1.2194502354, 1.219538331, 1.2199281454, 1.2199684381, 1.2201776505, 1.2202891111, 1.2204508781, 1.2204847336, 1.220552206, 1.2206734419, 1.2210950851, 1.2212122679, 1.22129035, 1.2216476202, 1.2218157053, 1.2218770981, 1.2219427824, 1.2221289873, 1.2221422195, 1.2222644091, 1.2232841253, 1.2236937284, 1.2237645388, 1.2238794565, 1.2239363194, 1.2239997387, 1.2248737812, 1.2250041962, 1.2254023552, 1.2254242897, 1.2258660793, 1.2260270119, 1.2261291742, 1.2262173891, 1.2268859148, 1.2271443605, 1.2273905277, 1.227452755, 1.2276697159, 1.2278308868, 1.2281776667, 1.2282141447, 1.2283557653, 1.2284872532, 1.228630662, 1.2290570736, 1.2295652628, 1.2296161652, 1.2299553156, 1.2301621437, 1.2303587198, 1.2305729389, 1.230753541, 1.2307626009, 1.2308850288, 1.2311425209, 1.2311933041, 1.231251359, 1.2314382792, 1.2316200733, 1.2317948341, 1.2317963839, 1.231856823, 1.2318732738, 1.2319331169, 1.2322188616, 1.2322387695, 1.2323983908, 1.2324955463, 1.2325015068, 1.2326164246, 1.2327426672, 1.2327539921, 1.2328281403, 1.2330471277, 1.2330479622, 1.2331953049, 1.2333698273, 1.2333928347, 1.2334609032, 1.2334756851, 1.2335807085, 1.2337765694, 1.2338055372, 1.2338081598, 1.2340250015, 1.2340496778, 1.2340977192, 1.2341663837, 1.2344316244, 1.2346278429, 1.2346340418, 1.2349319458, 1.2350541353, 1.2354059219, 1.2355134487, 1.2357062101, 1.2357251644, 1.235832572, 1.2359983921, 1.2361366749, 1.2366490364, 1.2369959354, 1.2370332479, 1.2373070717, 1.2375110388, 1.2376039028, 1.2376825809, 1.2376887798, 1.2376981974, 1.2378661633, 1.2379729748, 1.2380496264, 1.2385538816, 1.2389537096, 1.2394793034, 1.2400450706, 1.2401709557, 1.2404574156, 1.2406234741, 1.2408413887, 1.2413039207, 1.2413474321, 1.2428011894, 1.2433443069, 1.244150877, 1.244426012, 1.2452840805, 1.2453149557, 1.2453306913, 1.2454659939, 1.2458621264, 1.2459645271, 1.2468087673, 1.2468334436, 1.2474546432, 1.2476696968, 1.2477852106, 1.2480969429, 1.248368144, 1.2484965324, 1.2484992743, 1.2492444515, 1.2499938011, 1.2507902384, 1.2514961958, 1.2515923977, 1.2522245646, 1.252466917, 1.2532321215, 1.2536563873, 1.2558363676, 1.2565170527, 1.2573769093, 1.2585613728, 1.2585704327, 1.2587590218, 1.258865118, 1.2600241899, 1.2603937387, 1.2605997324, 1.2617887259, 1.263581872, 1.2637146711, 1.2641888857, 1.2652258873, 1.2667226791, 1.2669173479, 1.2680330276, 1.2682603598, 1.268397212, 1.2691706419, 1.2699007988, 1.2701907158, 1.270720005, 1.2741836309, 1.2742532492, 1.2749671936, 1.2761263847, 1.2765936852, 1.2767801285, 1.2793864012, 1.2801984549, 1.2834899426, 1.283701539, 1.2847063541, 1.2850489616, 1.2860957384, 1.2861280441, 1.2865720987, 1.2884337902, 1.2951054573, 1.2952955961, 1.2969464064, 1.2973487377, 1.3013883829, 1.3018374443, 1.3029315472, 1.306412816, 1.3107579947, 1.3117579222, 1.3122359514, 1.3131108284, 1.3144341707, 1.3193595409, 1.3414987326, 1.3551025391,
]

plt.figure(figsize=(8,3))
plt.bar(range(len(MSE_single_neurons)), MSE_single_neurons)
plt.plot(range(512), [0.008]*512, color='tab:orange')
plt.xlabel('Neurons')
plt.ylabel('MSE')
plt.tick_params(
    axis='x',          
    which='both',      
    bottom=False,      
    top=False,         
    labelbottom=False
) 
plt.savefig(plot_manager.get_path('single_neuron_count_prediction'))